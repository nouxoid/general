<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="general.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:general.Views"
    Background="White">
    
    <Page.Resources>
        <!-- Add the BoolToVisibilityConverter -->
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        
        <!-- Minimal flat DataTemplate for clipboard items -->
        <DataTemplate x:Key="ClipboardItemTemplate" x:DataType="local:ClipboardItem">
            <Border Background="White"
                    CornerRadius="4"
                    Margin="0,2,0,2"
                    Padding="16,12,16,12"
                    BorderBrush="#E5E5E5"
                    BorderThickness="1">
                
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- Content type icon - minimal and flat -->
                    <Border Grid.Column="0" 
                            Background="#F8F8F8"
                            CornerRadius="4"
                            Width="28"
                            Height="28"
                            VerticalAlignment="Top">
                        <FontIcon Glyph="{x:Bind ContentIcon}" 
                                  FontSize="12" 
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Foreground="#666666" />
                    </Border>
                    
                    <!-- Content area -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="3">
                        <!-- Main content text -->
                        <TextBlock Text="{x:Bind DisplayContent}" 
                                   FontSize="13"
                                   FontWeight="Normal"
                                   TextWrapping="Wrap"
                                   MaxLines="2"
                                   TextTrimming="CharacterEllipsis"
                                   Foreground="#333333" />
                        
                        <!-- Metadata row -->
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="{x:Bind ContentType}" 
                                       FontSize="11"
                                       Foreground="#999999"
                                       FontWeight="Medium" />
                            <TextBlock Text="{x:Bind TimeAgo}" 
                                       FontSize="11"
                                       Foreground="#BBBBBB" />
                            <FontIcon Glyph="&#xE734;" 
                                      FontSize="11"
                                      Foreground="#FFB900"
                                      Visibility="{x:Bind IsFavorite, Converter={StaticResource BoolToVisibilityConverter}}" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Always visible action buttons when item is in view -->
                    <Button Grid.Column="2"
                            Width="32" Height="32" 
                            CornerRadius="4" 
                            Background="Transparent"
                            BorderThickness="0"
                            ToolTipService.ToolTip="Copy" 
                            Click="OnCopyClicked">
                        <FontIcon Glyph="&#xE8C8;" FontSize="14" Foreground="#666666" />
                    </Button>
                    
                    <Button Grid.Column="3"
                            Width="32" Height="32" 
                            CornerRadius="4" 
                            Background="{x:Bind IsFavorite, Converter={StaticResource FavoriteButtonBackgroundConverter}}"
                            BorderThickness="0"
                            ToolTipService.ToolTip="Toggle Favorite" 
                            Click="OnToggleFavoriteClicked">
                        <FontIcon Glyph="&#xE734;" FontSize="14" Foreground="{x:Bind IsFavorite, Converter={StaticResource FavoriteButtonForegroundConverter}}" />
                    </Button>
                    
                    <Button Grid.Column="4"
                            Width="32" Height="32" 
                            CornerRadius="4" 
                            Background="Transparent"
                            BorderThickness="0"
                            ToolTipService.ToolTip="Delete" 
                            Click="OnDeleteClicked">
                        <FontIcon Glyph="&#xE74D;" FontSize="14" Foreground="#CC0000" />
                    </Button>
                </Grid>
            </Border>
        </DataTemplate>
        
        <!-- Converters for favorite button styling -->
        <local:FavoriteButtonBackgroundConverter x:Key="FavoriteButtonBackgroundConverter" />
        <local:FavoriteButtonForegroundConverter x:Key="FavoriteButtonForegroundConverter" />
        
        <!-- Minimal ListView Style with selection highlighting -->
        <Style x:Key="MinimalListViewStyle" TargetType="ListView">
            <Setter Property="ScrollViewer.HorizontalScrollMode" Value="Disabled" />
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />
            <Setter Property="SelectionMode" Value="Single" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="VerticalContentAlignment" Value="Stretch" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListViewItem">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4"
                                            Margin="0,1,0,1">
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup x:Name="CommonStates">
                                                <VisualState x:Name="Normal" />
                                                <VisualState x:Name="PointerOver">
                                                    <VisualState.Setters>
                                                        <Setter Target="RootBorder.Background" Value="#F5F5F5" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="Pressed">
                                                    <VisualState.Setters>
                                                        <Setter Target="RootBorder.Background" Value="#EEEEEE" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="Selected">
                                                    <VisualState.Setters>
                                                        <Setter Target="RootBorder.Background" Value="#E3F2FD" />
                                                        <Setter Target="RootBorder.BorderBrush" Value="#2196F3" />
                                                        <Setter Target="RootBorder.BorderThickness" Value="2" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="SelectedPointerOver">
                                                    <VisualState.Setters>
                                                        <Setter Target="RootBorder.Background" Value="#E3F2FD" />
                                                        <Setter Target="RootBorder.BorderBrush" Value="#2196F3" />
                                                        <Setter Target="RootBorder.BorderThickness" Value="2" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                        <Border x:Name="RootBorder" Background="Transparent" CornerRadius="4">
                                            <ContentPresenter Content="{TemplateBinding Content}"
                                                            ContentTemplate="{TemplateBinding ContentTemplate}"
                                                            Margin="{TemplateBinding Padding}"
                                                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                        </Border>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>
    
    <Grid Margin="20,16,20,16" Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <!-- Minimal Header -->
        <StackPanel x:Name="TopBar" Grid.Row="0" Margin="0,0,0,20" />
        
        <!-- Minimal Search Box -->
        <TextBox x:Name="SearchBox" 
                 Grid.Row="1"
                 PlaceholderText="Search clipboard..." 
                 Margin="0,0,0,20"
                 CornerRadius="4"
                 FontSize="13"
                 Padding="12,8,12,8"
                 Background="White"
                 BorderBrush="#E5E5E5"
                 BorderThickness="1"
                 TextChanged="OnSearchTextChanged" />
        
        <!-- Main Content Area -->
        <ScrollViewer Grid.Row="2" ZoomMode="Disabled" Background="Transparent">
            <StackPanel>
                <!-- Minimal Empty state -->
                <StackPanel x:Name="EmptyState" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center"
                           Margin="0,60,0,60"
                           Spacing="12"
                           Visibility="Visible">
                    <FontIcon Glyph="&#xE8C8;" 
                              FontSize="32" 
                              Foreground="#CCCCCC"
                              HorizontalAlignment="Center" />
                    <TextBlock Text="No clipboard history" 
                               FontSize="16"
                               FontWeight="Medium"
                               HorizontalAlignment="Center"
                               Foreground="#666666" />
                    <TextBlock Text="Copy something to get started"
                               FontSize="13"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"
                               Foreground="#999999" />
                </StackPanel>
                
                <!-- Clipboard Items List -->
                <ListView x:Name="ClipboardListView" 
                          Style="{StaticResource MinimalListViewStyle}"
                          ItemTemplate="{StaticResource ClipboardItemTemplate}" 
                          SelectionChanged="OnListViewSelectionChanged"
                          Visibility="Collapsed" />
            </StackPanel>
        </ScrollViewer>
        
        <!-- Settings Flyout -->
        <Popup x:Name="SettingsPopup" IsLightDismissEnabled="True">
            <Border Background="White" 
                    BorderBrush="#E5E5E5" 
                    BorderThickness="1" 
                    CornerRadius="8"
                    Padding="16"
                    Width="280">
                <StackPanel Spacing="12">
                    <TextBlock Text="Settings" FontSize="16" FontWeight="SemiBold" Foreground="#333333" />
                    
                    <StackPanel Spacing="8">
                        <TextBlock Text="History" FontSize="13" FontWeight="Medium" Foreground="#666666" />
                        <TextBlock Text="• Keep items for 7 days" FontSize="12" Foreground="#999999" />
                        <TextBlock Text="• Maximum 100 items" FontSize="12" Foreground="#999999" />
                    </StackPanel>
                    
                    <StackPanel Spacing="8">
                        <TextBlock Text="Actions" FontSize="13" FontWeight="Medium" Foreground="#666666" />
                        <Button Content="Show only favorites" 
                                Click="OnShowFavoritesClicked" 
                                Background="#F8F8F8" 
                                BorderThickness="0" 
                                CornerRadius="4"
                                HorizontalAlignment="Stretch" />
                        <Button Content="Clear all history" 
                                Click="OnClearAllClicked" 
                                Background="#FFEBEE" 
                                Foreground="#CC0000"
                                BorderThickness="0" 
                                CornerRadius="4"
                                HorizontalAlignment="Stretch" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</Page>
